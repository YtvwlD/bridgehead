version: "3.7"

services:
  fhir2sql:
    depends_on:
      - "dashboard-db"
    image: docker.verbis.dkfz.de/cache/samply/fhir2sql:latest
    container_name: bridgehead-ccp-dashboard-fhir2sql
    environment:
      BLAZE_BASE_URL: "http://blaze:8080/fhir/"
      PG_HOST: "dashboard-db"
      PG_PORT: 5432
      PG_USERNAME: "dashboard"
      PG_PASSWORD: "${DASHBOARD_DB_PASSWORD}" # Set in exporter-setup.sh
      PG_DBNAME: "dashboard"
      # TODO: Remove the following, replace with defaults in app
      BLAZE_PAGE_RESOURCE_COUNT: 10000
      PG_BATCH_SIZE: 10000

  dashboard-db:
    image: docker.verbis.dkfz.de/cache/postgres:${POSTGRES_TAG}
    container_name: bridgehead-ccp-dashboard-db
    environment:
      POSTGRES_USER: "dashboard"
      POSTGRES_PASSWORD: "${DASHBOARD_DB_PASSWORD}" # Set in exporter-setup.sh
      POSTGRES_DB: "dashboard"
    volumes:
      - "/var/cache/bridgehead/ccp/dashboard-db:/var/lib/postgresql/data"
