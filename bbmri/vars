# Makes sense for all European Biobanks
: ${ENABLE_ERIC:=true}

# Makes only sense for German Biobanks
: ${ENABLE_GBN:=false}

# Makes only sense for EHDS2 project
: ${ENABLE_EHDS2:=false}

FOCUS_RETRY_COUNT=32
PRIVATEKEYFILENAME=/etc/bridgehead/pki/${SITE_ID}.priv.pem

for module in $PROJECT/modules/*.sh
do
    log DEBUG "sourcing $module"
    source $module
done

SUPPORT_EMAIL=$ERIC_SUPPORT_EMAIL
BROKER_URL_FOR_PREREQ="https://ecdc-vm-ehds-test1.swedencentral.cloudapp.azure.com"

if [ -n "$GBN_SUPPORT_EMAIL" ]; then
    SUPPORT_EMAIL=$GBN_SUPPORT_EMAIL
fi

if [ -n "$EHDS2_SUPPORT_EMAIL" ]; then
    SUPPORT_EMAIL=$EHDS2_SUPPORT_EMAIL
fi

function do_enroll {
    COUNT=0
    if [ "$ENABLE_ERIC" == "true" ]; then
        do_enroll_inner $ERIC_PROXY_ID $ERIC_SUPPORT_EMAIL
        COUNT=$((COUNT+1))
    fi
    if [ "$ENABLE_GBN" == "true" ]; then
        do_enroll_inner $GBN_PROXY_ID $GBN_SUPPORT_EMAIL
        COUNT=$((COUNT+1))
    fi
    if [ "$ENABLE_EHDS2" == "true" ]; then
        do_enroll_inner $EHDS2_PROXY_ID $EHDS2_SUPPORT_EMAIL
        COUNT=$((COUNT+1))
    fi
    if [ $COUNT -ge 2 ]; then
        echo
        echo "You just received $COUNT certificate signing requests (CSR). Please send $COUNT e-mails, with 1 CSR each, to the respective e-mail address."
    fi
}
